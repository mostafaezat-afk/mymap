<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <title>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª - Ø¨Ø´ØªÙŠÙ„</title>
  <meta name="theme-color" content="#2196f3">
  
  <!-- Preconnect Ù„Ù„Ø³Ø±Ø¹Ø© -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://maps.googleapis.com">
  <link rel="dns-prefetch" href="https://script.google.com">
  
  <!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet"/>
  
  <script>
    const CONFIG = {
      WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbyVW8NG--5KGo9i9ho3aT1t6zPt9dB1aBKaJbkb8q0yFP5BKiK2Koke4tDjezL3Oo9D/exec',
      GOOGLE_MAPS_API_KEY: 'AIzaSyBT2qu6ecTsP-5xCs6lKuj_OO4UtqOFaJ8'
    };
    
    function goToRegistration() {
      window.location.href = 'https://mostafaezat-afk.github.io/mymap/re.html';
    }
    
    function goToSearch() {
      resetSearch();
    }
  </script>
  
  <style>
    /* Critical CSS */
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    html,body{width:100%;height:100%;font-family:'Tajawal',sans-serif;background:#f5f8fa}
    
    /* Splash Screen */
    .splash{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#2196f3,#1976d2);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:99999;transition:opacity 0.3s}
    .splash.hidden{opacity:0;pointer-events:none}
    .splash-logo{font-size:8rem;animation:bounce 1s infinite}
    .splash-text{color:#fff;font-size:3rem;font-weight:800;margin-top:2rem;text-align:center;padding:0 2rem}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    
    /* Common */
    :root{--primary:#2196f3;--secondary:#4caf50;--accent:#f44336;--text:#1a1a2e}
    .hidden{display:none!important}
    
    /* Mobile View */
    .mobile{display:none;width:100%;min-height:100vh}
    .mobile.active{display:block}
    .mobile-header{background:linear-gradient(135deg,var(--primary),#42a5f5);padding:2rem;text-align:center;color:#fff;position:sticky;top:0;z-index:100;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
    .mobile-header h1{font-size:3.5rem;font-weight:800;margin-bottom:1.5rem}
    .mobile-btns{display:flex;gap:1.5rem;justify-content:center;flex-wrap:wrap}
    .mobile-btn{padding:1.5rem 2.5rem;border-radius:20px;border:none;font-size:2rem;font-weight:700;color:#fff;cursor:pointer;font-family:'Tajawal',sans-serif;transition:transform 0.2s;text-decoration:none;display:inline-flex;align-items:center;gap:1rem}
    .mobile-btn:active{transform:scale(0.95)}
    .mobile-btn-search{background:linear-gradient(135deg,#f44336,#d32f2f)}
    .mobile-btn-add{background:linear-gradient(135deg,var(--secondary),#388e3c)}
    
    /* Mobile Content */
    .mobile-content{padding:2rem}
    .mobile-section{background:#fff;border-radius:20px;padding:2rem;margin-bottom:2rem;box-shadow:0 4px 15px rgba(0,0,0,0.08)}
    .section-title{font-size:2.5rem;font-weight:700;color:var(--primary);margin-bottom:1.5rem;display:flex;align-items:center;gap:1rem}
    .section-icon{font-size:3rem}
    .info-text{font-size:2rem;color:#666;text-align:center;margin-bottom:1.5rem}
    
    /* Filter Grid */
    .filter-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem}
    .filter-card{border:4px solid #e1e8ed;border-radius:20px;padding:2rem 1rem;text-align:center;background:#f5f8fa;cursor:pointer;transition:all 0.2s;min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.8rem}
    .filter-card:active{transform:scale(0.95)}
    .filter-card.selected{border-color:var(--primary);background:#fff;box-shadow:0 8px 20px rgba(33,150,243,0.3)}
    .filter-icon{font-size:3rem}
    .filter-label{font-size:1.6rem;font-weight:700;color:var(--text)}
    
    /* Activity List - Ù…ÙØ¨Ø³Ø· Ø¬Ø¯Ø§Ù‹ */
    .activity-list{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-top:2rem}
    .activity-item{background:#fff;border:3px solid #e1e8ed;border-radius:15px;padding:1.5rem;text-align:center;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:1rem}
    .activity-item:active{transform:scale(0.95)}
    .activity-icon{font-size:3.5rem}
    .activity-name{font-size:1.7rem;font-weight:600;color:var(--text)}
    
    /* Loading & Messages */
    .loading,.error,.no-results{font-size:2.5rem;text-align:center;padding:3rem;font-weight:700}
    .loading{color:var(--primary)}
    .error{background:#ffebee;color:var(--accent);border-radius:15px}
    .no-results{color:#666}
    
    /* Results */
    .result-card{background:#fff;border-radius:20px;padding:2.5rem;margin-bottom:2rem;box-shadow:0 8px 20px rgba(0,0,0,0.1);border-right:8px solid var(--secondary)}
    .result-title{font-size:2.8rem;font-weight:800;color:var(--primary);margin-bottom:1.5rem}
    .result-info{font-size:2.2rem;color:var(--text);margin:1rem 0;font-weight:600}
    .result-info a{color:var(--primary);text-decoration:none;font-weight:700}
    .map-btn{width:100%;padding:2rem;background:linear-gradient(135deg,var(--secondary),#388e3c);color:#fff;border:none;border-radius:15px;font-size:2.2rem;font-weight:700;cursor:pointer;margin-top:1.5rem;font-family:'Tajawal',sans-serif}
    .map-btn:active{transform:scale(0.98)}
    
    /* Desktop View */
    .desktop{display:none;background:#f5f8fa;min-height:100vh;padding:2rem}
    .desktop.active{display:block}
    .desktop-container{max-width:1400px;margin:0 auto}
    .desktop-header{background:linear-gradient(135deg,var(--primary),#42a5f5);padding:2rem;text-align:center;color:#fff;border-radius:20px;margin-bottom:2rem;box-shadow:0 8px 20px rgba(0,0,0,0.1)}
    .desktop-header h1{font-size:2rem;font-weight:800;margin-bottom:1rem}
    .desktop-btns{display:flex;gap:1rem;justify-content:center}
    .desktop-btn{padding:0.8rem 1.5rem;border-radius:12px;border:none;font-size:1rem;font-weight:700;color:#fff;cursor:pointer;font-family:'Tajawal',sans-serif;transition:all 0.2s;text-decoration:none}
    .desktop-btn:hover{transform:translateY(-2px)}
    .desktop-btn-search{background:linear-gradient(135deg,#f44336,#d32f2f)}
    .desktop-btn-add{background:linear-gradient(135deg,var(--secondary),#388e3c)}
    
    /* Desktop Content */
    .desktop-content{display:grid;grid-template-columns:1fr 600px;gap:2rem}
    .desktop-main{background:#fff;padding:2rem;border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.1)}
    .desktop-section{margin-bottom:2rem}
    .desktop-section-title{font-size:1.3rem;font-weight:700;color:var(--primary);margin-bottom:1rem;padding-bottom:0.8rem;border-bottom:2px solid #e1e8ed;display:flex;align-items:center;gap:0.8rem}
    .desktop-icon{font-size:1.5rem}
    .desktop-info{font-size:0.95rem;color:#666;text-align:center;margin-bottom:1rem}
    
    /* Desktop Filters */
    .desktop-filter-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}
    .desktop-filter{border:2px solid #e1e8ed;border-radius:12px;padding:1rem;text-align:center;background:#f5f8fa;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:0.5rem}
    .desktop-filter:hover{transform:translateY(-3px)}
    .desktop-filter.selected{border-color:var(--primary);background:#fff;box-shadow:0 4px 15px rgba(33,150,243,0.2)}
    .desktop-filter-icon{font-size:1.8rem}
    .desktop-filter-label{font-size:0.85rem;font-weight:700}
    
    /* Desktop Activities */
    .desktop-activities{display:grid;grid-template-columns:repeat(4,1fr);gap:0.8rem;margin-top:1.5rem}
    .desktop-activity{border:2px solid #e1e8ed;border-radius:10px;padding:1rem 0.5rem;text-align:center;background:#f5f8fa;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:0.4rem}
    .desktop-activity:hover{transform:translateY(-3px)}
    .desktop-activity-icon{font-size:1.8rem}
    .desktop-activity-name{font-size:0.8rem;font-weight:600}
    
    /* Desktop Map */
    .desktop-map-box{background:#fff;padding:1.5rem;border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.1);position:sticky;top:2rem}
    .desktop-map-title{font-size:1.2rem;color:var(--primary);margin-bottom:1rem;font-weight:700}
    .map-container{width:100%;height:600px;border-radius:15px;overflow:hidden;background:#e0e0e0}
    #mobileMap,#desktopMap{width:100%;height:100%}
    
    /* Fullscreen Map */
    .fullscreen-map{position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;background:#fff;display:none}
    .fullscreen-map.active{display:block}
    .close-map{position:fixed;top:2rem;right:2rem;background:var(--accent);color:#fff;border:none;padding:1.5rem 2rem;border-radius:15px;font-size:2rem;font-weight:800;cursor:pointer;z-index:99999;box-shadow:0 4px 15px rgba(0,0,0,0.3);font-family:'Tajawal',sans-serif}
    .close-map:active{transform:scale(0.95)}
    
    @media (max-width:1024px){.desktop-content{grid-template-columns:1fr}.desktop-map-box{position:relative;top:0}}
  </style>
</head>
<body>
  <div class="splash" id="splash">
    <div class="splash-logo">ğŸ”</div>
    <div class="splash-text">Ø¯Ù„ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ø¨Ø´ØªÙŠÙ„</div>
  </div>

  <!-- Mobile View -->
  <div class="mobile" id="mobileView">
    <div class="mobile-header">
      <h1>ğŸ” Ø¯Ù„ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ø¨Ø´ØªÙŠÙ„</h1>
      <div class="mobile-btns">
        <button class="mobile-btn mobile-btn-search" onclick="goToSearch()">ğŸ” Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</button>
        <a href="https://mostafaezat-afk.github.io/mymap/re.html" class="mobile-btn mobile-btn-add">âœï¸ Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·</a>
      </div>
    </div>
    <div class="mobile-content">
      <div class="loading hidden" id="mobileLoading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>
      <div class="error hidden" id="mobileError"></div>
      <div id="mobileResults" class="hidden"></div>
      <div id="mobileSearch">
        <div class="mobile-section">
          <div class="section-title"><span class="section-icon">ğŸ”</span>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</div>
          <p class="info-text">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø£ÙˆÙ„Ø§Ù‹</p>
          <div class="filter-grid" id="mobileFilters"></div>
        </div>
        <div id="mobileActivities"></div>
      </div>
    </div>
    <div class="fullscreen-map" id="mobileFullscreen">
      <button class="close-map" id="closeMap">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
      <div id="mobileMap" class="map-container"></div>
    </div>
  </div>

  <!-- Desktop View -->
  <div class="desktop" id="desktopView">
    <div class="desktop-container">
      <div class="desktop-header">
        <h1>ğŸ” Ø¯Ù„ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ø¨Ø´ØªÙŠÙ„</h1>
        <div class="desktop-btns">
          <button class="desktop-btn desktop-btn-search" onclick="goToSearch()">ğŸ” Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</button>
          <a href="https://mostafaezat-afk.github.io/mymap/re.html" class="desktop-btn desktop-btn-add">âœï¸ Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·</a>
        </div>
      </div>
      <div class="loading hidden" id="desktopLoading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>
      <div class="error hidden" id="desktopError"></div>
      <div class="desktop-content">
        <div class="desktop-main">
          <div class="desktop-section">
            <div class="desktop-section-title"><span class="desktop-icon">ğŸ”</span>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
            <p class="desktop-info">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø«Ù… Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ø¨Ø­Ø«</p>
            <div class="desktop-filter-grid" id="desktopFilters"></div>
          </div>
          <div class="desktop-section"><div id="desktopActivities"></div></div>
          <div class="desktop-section"><div id="desktopResults"></div></div>
        </div>
        <div class="desktop-sidebar">
          <div class="desktop-map-box">
            <div class="desktop-map-title">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</div>
            <div class="map-container"><div id="desktopMap"></div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙØ¨Ø³Ø·Ø© Ø¬Ø¯Ø§Ù‹ - ÙÙ‚Ø· Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ
    const categories = [
      {id:"all",icon:"ğŸŒŸ",label:"Ø§Ù„ÙƒÙ„"},
      {id:"food",icon:"ğŸ½ï¸",label:"Ù…Ø£ÙƒÙˆÙ„Ø§Øª"},
      {id:"grocery",icon:"ğŸ›’",label:"Ø¨Ù‚Ø§Ù„Ø©"},
      {id:"services",icon:"ğŸ”§",label:"Ø®Ø¯Ù…Ø§Øª"},
      {id:"shops",icon:"ğŸª",label:"Ù…Ø­Ù„Ø§Øª"},
      {id:"medical",icon:"âš•ï¸",label:"Ø·Ø¨ÙŠ"},
      {id:"general",icon:"ğŸ“Œ",label:"Ø¹Ø§Ù…"}
    ];

    // âœ… Ø§Ù„Ø£Ù†Ø´Ø·Ø© - ØªÙØ­Ù…Ù‘Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨ ÙÙ‚Ø·
    const activities = {
      food: [
        {name:"ÙƒØ´Ø±ÙŠ",icon:"ğŸ²"},{name:"ÙƒØ¨Ø§Ø¨Ø¬ÙŠ",icon:"ğŸ–"},{name:"ÙØ±Ø§Ø±Ø¬ÙŠ",icon:"ğŸ—"},
        {name:"ÙÙˆÙ„ ÙˆØ·Ø¹Ù…ÙŠØ©",icon:"ğŸ§†"},{name:"Ø£Ø³Ù…Ø§Ùƒ",icon:"ğŸŸ"},{name:"Ø¨ÙŠØªØ²Ø§",icon:"ğŸ•"},
        {name:"Ø­Ù„ÙˆØ§Ù†ÙŠ",icon:"ğŸ‚"},{name:"ÙƒØ§ÙØªÙŠØ±ÙŠØ§",icon:"â˜•"},{name:"Ø¹ØµÙŠØ±",icon:"ğŸ¹"}
      ],
      grocery: [
        {name:"Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª",icon:"ğŸ›’"},{name:"Ø®Ø¶Ø±ÙˆØ§Øª",icon:"ğŸ"},{name:"Ø¬Ø²Ø§Ø±",icon:"ğŸ¥©"},
        {name:"Ù…Ø®Ø¨Ø²",icon:"ğŸ"},{name:"ÙØ±Ù†",icon:"ğŸ¥"},{name:"Ø¹Ø·Ø§Ø±Ø©",icon:"ğŸ¯"},
        {name:"ØªÙ…ÙˆÙŠÙ†",icon:"ğŸª"},{name:"Ø£Ù„Ø¨Ø§Ù†",icon:"ğŸ¥›"}
      ],
      services: [
        {name:"Ø³Ø¨Ø§Ùƒ",icon:"ğŸ”§"},{name:"ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ",icon:"âš¡"},{name:"ØµÙŠØ§Ù†Ø©",icon:"ğŸ”Œ"},
        {name:"Ø³Ø®Ø§Ù†Ø§Øª",icon:"ğŸ”¥"},{name:"ÙƒÙ…Ø¨ÙŠÙˆØªØ±",icon:"ğŸ’»"},{name:"Ù†Ø¬Ø§Ø±",icon:"ğŸ› ï¸"},
        {name:"Ù†Ù‚Ø§Ø´",icon:"ğŸ¨"},{name:"Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ",icon:"ğŸš—"},{name:"ØªÙƒÙŠÙŠÙ",icon:"â„ï¸"}
      ],
      shops: [
        {name:"Ù…Ù„Ø§Ø¨Ø³",icon:"ğŸ‘•"},{name:"Ù…Ø­Ù…ÙˆÙ„",icon:"ğŸ“±"},{name:"Ù…ÙƒØªØ¨Ø©",icon:"ğŸ“š"},
        {name:"Ø­Ø¯Ø§ÙŠØ¯",icon:"ğŸ "},{name:"Ø¬ÙˆØ§Ù‡Ø±Ø¬ÙŠ",icon:"ğŸ’"},{name:"Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©",icon:"ğŸ§¹"},
        {name:"Ø£Ø­Ø°ÙŠØ©",icon:"ğŸ‘Ÿ"},{name:"Ù…ÙØ±ÙˆØ´Ø§Øª",icon:"ğŸ›ï¸"},{name:"ÙƒÙˆØ§ÙÙŠØ±",icon:"ğŸ’‡"}
      ],
      medical: [
        {name:"Ø¨Ø§Ø·Ù†Ø©",icon:"ğŸ©º"},{name:"Ù‚Ù„Ø¨",icon:"â¤ï¸"},{name:"Ø£Ø·ÙØ§Ù„",icon:"ğŸ‘¶"},
        {name:"Ø¹Ø¸Ø§Ù…",icon:"ğŸ¦´"},{name:"Ø£Ù†Ù ÙˆØ£Ø°Ù†",icon:"ğŸ‘‚"},{name:"Ù†Ø³Ø§Ø¡",icon:"ğŸ¤°"},
        {name:"Ø¹ÙŠÙˆÙ†",icon:"ğŸ‘ï¸"},{name:"Ø£Ø³Ù†Ø§Ù†",icon:"ğŸ¦·"},{name:"ØµÙŠØ¯Ù„ÙŠØ©",icon:"ğŸ’Š"}
      ],
      general: [
        {name:"ØªÙˆØµÙŠÙ„",icon:"ğŸšš"},{name:"Ù…Ø¯Ø±Ø³Ø©",icon:"ğŸ«"},{name:"Ù…Ø±Ø§ÙƒØ² ØªÙ‚ÙˆÙŠØ©",icon:"ğŸ“"},
        {name:"Ù…Ø­Ø§Ù…ÙŠ",icon:"âš–ï¸"},{name:"Ø¹Ù‚Ø§Ø±Ø§Øª",icon:"ğŸ¡"},{name:"Ø¨Ù„Ø§ÙŠØ³ØªÙŠØ´Ù†",icon:"ğŸ®"},
        {name:"Ø¬ÙŠÙ…",icon:"ğŸ‹ï¸"},{name:"Ø³Ø§ÙŠØ¨Ø±",icon:"ğŸ–¥ï¸"}
      ]
    };

    let selectedCat = 'all';
    let mobileMap, desktopMap;
    let markers = [];
    let infoWindows = [];
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

    function resetSearch() {
      selectedCat = 'all';
      markers.forEach(m => {if(m.marker) m.marker.setMap(null)});
      markers = [];
      infoWindows = [];
      
      if (isMobile) {
        document.getElementById('mobileResults').classList.add('hidden');
        document.getElementById('mobileSearch').classList.remove('hidden');
        document.getElementById('mobileResults').innerHTML = '';
        loadFilters('mobile');
        loadActivities('mobile', 'all');
      } else {
        document.getElementById('desktopResults').innerHTML = '';
        loadFilters('desktop');
        loadActivities('desktop', 'all');
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      if (isMobile) {
        document.getElementById('mobileView').classList.add('active');
        loadFilters('mobile');
        loadActivities('mobile', 'all');
        document.getElementById('closeMap').onclick = () => {
          document.getElementById('mobileFullscreen').classList.remove('active');
        };
      } else {
        document.getElementById('desktopView').classList.add('active');
        loadFilters('desktop');
        loadActivities('desktop', 'all');
      }
    });

    function loadFilters(view) {
      const grid = view === 'mobile' ? document.getElementById('mobileFilters') : document.getElementById('desktopFilters');
      grid.innerHTML = '';
      
      categories.forEach(cat => {
        const card = document.createElement('div');
        card.className = view === 'mobile' ? 'filter-card' : 'desktop-filter';
        if (cat.id === selectedCat) card.classList.add('selected');
        card.innerHTML = `<div class="${view === 'mobile' ? 'filter' : 'desktop-filter'}-icon">${cat.icon}</div><div class="${view === 'mobile' ? 'filter' : 'desktop-filter'}-label">${cat.label}</div>`;
        card.onclick = () => selectFilter(cat.id, view);
        grid.appendChild(card);
      });
    }

    function selectFilter(catId, view) {
      selectedCat = catId;
      loadFilters(view);
      loadActivities(view, catId);
    }

    function loadActivities(view, filter) {
      const container = view === 'mobile' ? document.getElementById('mobileActivities') : document.getElementById('desktopActivities');
      container.innerHTML = '';
      
      if (filter === 'all') {
        container.innerHTML = `<div class="mobile-section"><p class="info-text">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ø´Ø·Ø©</p></div>`;
        return;
      }
      
      const items = activities[filter] || [];
      if (items.length === 0) return;
      
      const section = document.createElement('div');
      section.className = 'mobile-section';
      
      const title = document.createElement('div');
      title.className = view === 'mobile' ? 'section-title' : 'desktop-section-title';
      title.innerHTML = `<span class="${view === 'mobile' ? 'section' : 'desktop'}-icon">${categories.find(c=>c.id===filter)?.icon}</span>${categories.find(c=>c.id===filter)?.label}`;
      section.appendChild(title);
      
      const grid = document.createElement('div');
      grid.className = view === 'mobile' ? 'activity-list' : 'desktop-activities';
      
      items.forEach(act => {
        const card = document.createElement('div');
        card.className = view === 'mobile' ? 'activity-item' : 'desktop-activity';
        card.innerHTML = `<div class="${view === 'mobile' ? 'activity' : 'desktop-activity'}-icon">${act.icon}</div><div class="${view === 'mobile' ? 'activity' : 'desktop-activity'}-name">${act.name}</div>`;
        card.onclick = () => searchActivity(act.name, view);
        grid.appendChild(card);
      });
      
      section.appendChild(grid);
      container.appendChild(section);
    }

    function searchActivity(activityName, view) {
      const prefix = view === 'mobile' ? 'mobile' : 'desktop';
      document.getElementById(`${prefix}Error`).classList.add('hidden');
      document.getElementById(`${prefix}Loading`).classList.remove('hidden');
      
      if (view === 'mobile') {
        document.getElementById('mobileSearch').classList.add('hidden');
      }

      fetch(`${CONFIG.WEB_APP_URL}?action=getProvidersByActivity&activity=${encodeURIComponent(activityName)}`)
        .then(response => response.json())
        .then(data => {
          showResults(data, activityName, view);
        })
        .catch(error => {
          document.getElementById(`${prefix}Error`).textContent = "âŒ Ø®Ø·Ø£: " + error.message;
          document.getElementById(`${prefix}Error`).classList.remove('hidden');
          document.getElementById(`${prefix}Loading`).classList.add('hidden');
        });
    }

    function showResults(providers, activityName, view) {
      const prefix = view === 'mobile' ? 'mobile' : 'desktop';
      document.getElementById(`${prefix}Loading`).classList.add('hidden');
      
      const resultsDiv = document.getElementById(`${prefix}Results`);
      resultsDiv.innerHTML = '';
      resultsDiv.classList.remove('hidden');
      
      markers.forEach(m => {if(m.marker) m.marker.setMap(null)});
      markers = [];
      infoWindows = [];
      
      if (!providers || providers.length === 0) {
        resultsDiv.innerHTML = `<div class="no-results">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù†Ø´Ø§Ø·: <strong>${activityName}</strong></div>`;
        return;
      }
      
      providers.forEach((p, index) => {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.innerHTML = `
          <div class="result-title">${p.name}</div>
          <div class="result-info">ğŸ› ï¸ ${p.activity}</div>
          <div class="result-info">ğŸ“ <a href="tel:${p.phone}">${p.phone}</a></div>
          <div class="result-info">ğŸ“ ${p.address}</div>
          <div class="result-info">ğŸ•’ ${p.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
          <button class="map-btn" onclick="viewOnMap(${index},'${view}')">ğŸ—ºï¸ Ø´Ø§Ù‡Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
        `;
        resultsDiv.appendChild(card);
      });
      
      addMarkers(providers, view);
      centerMap(providers, view);
    }

    function addMarkers(providers, view) {
      const map = view === 'mobile' ? mobileMap : desktopMap;
      
      providers.forEach((p, index) => {
        const marker = new google.maps.Marker({
          position: {lat: p.lat, lng: p.lng},
          map: map,
          title: p.name,
          label: {text: p.name, color: '#FFF', fontSize: '12px', fontWeight: 'bold'}
        });
        
        const infoWindow = new google.maps.InfoWindow({
          content: `<div style="font-family:Tajawal;direction:rtl;padding:15px;max-width:80vw"><div style="font-size:1.8rem;font-weight:800;color:#1976d2">${p.name}</div><div style="margin:8px 0;font-size:1.4rem">ğŸ› ï¸ ${p.activity}</div><div style="margin:6px 0;font-size:1.2rem">ğŸ“ <a href="tel:${p.phone}" style="color:#2196f3">${p.phone}</a></div><div style="margin:6px 0;font-size:1.1rem">ğŸ“ ${p.address}</div></div>`,
          maxWidth: 700
        });
        
        marker.addListener("click", function() {
          infoWindows.forEach(iw => iw.close());
          map.setCenter(marker.getPosition());
          map.setZoom(19);
          infoWindow.open(map, marker);
        });
        
        markers.push({marker});
        infoWindows.push(infoWindow);
      });
    }

    function centerMap(providers, view) {
      const map = view === 'mobile' ? mobileMap : desktopMap;
      
      if (providers.length > 0) {
        const bounds = new google.maps.LatLngBounds();
        providers.forEach(p => bounds.extend(new google.maps.LatLng(p.lat, p.lng)));
        map.fitBounds(bounds);
        if (providers.length === 1) map.setZoom(17);
      }
    }

    function viewOnMap(index, view) {
      if (markers && markers[index]) {
        const map = view === 'mobile' ? mobileMap : desktopMap;
        
        if (view === 'mobile') {
          document.getElementById('mobileFullscreen').classList.add('active');
          setTimeout(function() {
            google.maps.event.trigger(map, 'resize');
            google.maps.event.trigger(markers[index].marker, 'click');
          }, 200);
        } else {
          google.maps.event.trigger(markers[index].marker, 'click');
          document.querySelector('.desktop-map-box').scrollIntoView({behavior: 'smooth'});
        }
      }
    }

    function initMap() {
      const beshtil = {lat: 30.0856171, lng: 31.1819895};
      const mapOptions = {
        center: beshtil,
        zoom: 16,
        mapTypeId: google.maps.MapTypeId.HYBRID,
        gestureHandling: 'greedy',
        zoomControl: true,
        mapTypeControl: false,
        streetViewControl: true,
        fullscreenControl: false
      };
      
      if (isMobile) {
        mobileMap = new google.maps.Map(document.getElementById("mobileMap"), mapOptions);
      } else {
        desktopMap = new google.maps.Map(document.getElementById("desktopMap"), mapOptions);
      }
    }

    // âœ… ØªØ­Ù…ÙŠÙ„ Ù…Ø¤Ø¬Ù„
    window.addEventListener('load', function() {
      setTimeout(function() {
        document.getElementById('splash').classList.add('hidden');
        
        const script = document.createElement('script');
        script.src = 'https://maps.googleapis.com/maps/api/js?key=' + CONFIG.GOOGLE_MAPS_API_KEY + '&callback=initMap&language=ar&region=EG';
        script.async = true;
        document.head.appendChild(script);
      }, 500);
    });
  </script>
</body>
</html>
